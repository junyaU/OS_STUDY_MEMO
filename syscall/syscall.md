# システムコール

<img width="2059" alt="スクリーンショット 2023-06-25 0 13 15" src="https://github.com/junyaU/os_study_memo/assets/61627945/06a4e214-0b14-4f5c-8c0b-86d4584965a5">

## システムコールとは
スーパーバイザコール（SVC）とも呼ばれるシステムコールは、ユーザプログラムがカーネルの機能を利用するための仕組みの事である。 \
逆に言えば、システムコールを利用しないと、ユーザプログラムはカーネルの機能を利用することができない。\
ユーザプログラムがカーネルの機能を利用するために設置された唯一の窓口となる。

そんなことしなくても、ユーザプログラムからカーネルの機能をそのまま呼び出せばいいのでは？と思うかもしれないが、\
実際に、ユーザープログラムからカーネルの機能をシステムコールを介さずに呼び出そうとすると、一般保護例外というCPU例外が発生してしまう。\
なぜ、わざわざシステムコールという仕組みを設けて、カーネルの機能を利用しなければいけないのか？

## なぜシステムコールが必要なのか
主な理由は以下の（多分）2つである。
- ユーザプログラムが安全にカーネルの機能を利用できるようにするため
- プログラムとハードウェアとの間の抽象化を実現するため

これらを順番に見ていく。

### ユーザプログラムが安全にカーネルの機能を利用できるようにするため
まず、システムコールを利用せずとも、ユーザプログラムからカーネルの機能を呼び出すことができてしまう場合のことを考えてみる。\
これは、ユーザプログラムからOSのメモリ空間に直接アクセスし書き換えたり、ハードウェアリソースを直接操作したりできてしまう状態である。\
これでは、ユーザプログラムがOSのメモリ空間を破壊してしまったり、ハードウェアリソースを破壊してしまったりしてしまうことが容易に想像できる。

OSはシステム全体の安全性と整合性を維持する責任があるため、ユーザプログラムからのOSの機能やハードウェアリソースへの直接のアクセスを禁止し、\
ユーザプログラムが必要とするOSの機能をシステムコールという形で提供することで、システム全体の安全性と整合性を維持することができる。
### プログラムとハードウェアとの間の抽象化を実現するため
システムコールは、ユーザプログラムとハードウェアとの間の抽象化を実現するためにも利用される。\
例えば、プログラムで文字列を出力する際に、printfのような関数を使って簡単に画面に文字列を出力することができているが、\
これは、システムコールを利用しているおかげで、ユーザプログラムはVRAMのフレームバッファに値を書き込むというような、 \
ハードウェアの詳細を意識することなく、画面に文字列を出力することができる。

システムコールがなければ、ユーザプログラムはハードウェアの制御まで考えなければならないため、プログラムが複雑になってしまうし、
ハードウェアの仕様が変わった場合に、ユーザプログラムも変更しなければならなくなってしまう。\
そういったことを防ぐための緩衝材として、システムコールが利用されている。
