# ユーザーモードとカーネルモード
![スクリーンショット 2023-06-25 10 47 09](https://github.com/junyaU/os_study_memo/assets/61627945/6c00298f-0fac-4fe6-8791-63421299f886)

## ユーザーモードとカーネルモードとは
CPUには、ユーザーモードとカーネルモードという2つのモードがある。\
カーネルモードはリング0、ユーザーモードはリング3とも呼ばれる。

### カーネルモード
カーネルモードは特権モードとも呼ばれ、OSはこのモードで動作する。\
このモードでは、メモリ管理やI/O操作、ハードウェアの制御など、システム全体に影響を与える可能性のある操作が許可されている。 \
これらの操作は特権命令と呼ばれ、ユーザーモードでは実行できない。\
カーネルモードで動作するプログラムは、OSの中核であるカーネルと呼ばれる。

### ユーザーモード 
ユーザーモードは、カーネルモードとは対照的に、ユーザーがアプリケーションを実行するためのモードである。\
ユーザーモードでは、特権命令は実行できない。\
システム全体のリソースを直接操作する権限は持っておらず、OSのカーネルを通して操作する必要がある。　\
また、ユーザーモードでは、カーネルモードで実行されているプログラムのメモリ空間にアクセスすることはできない。 \
ユーザーモードで動作するプログラムは、独自のメモリ空間を持ち、他のプログラムのメモリ空間にアクセスすることはできない。

## なぜ2つのモードが必要なのか
モードがない場合の問題点を考えてみる。\
ユーザプログラムで、特権命令を実行できてしまうので、例えばプロセッサをアイドル状態にするHalt命令がユーザプログラムから実行されてしまうと、\
OSがユーザプログラムからの操作によって停止してしまう。\
また、ユーザプログラムが他のユーザプログラムのメモリ空間にアクセスできてしまうと、他のユーザプログラムのメモリを破壊してしまう可能性がある。\
このような問題を防ぐために、ユーザーモードとカーネルモードがある。

システムコールは、ユーザーモードのプログラムからカーネルモードのプログラムに処理を委譲するための仕組みであるといえる。\
システムコールを呼び出すと、ユーザーモードからカーネルモードに切り替わり、カーネルモードでシステムコールの処理が行われる。\
システムコールの処理が終わると、カーネルモードからユーザーモードに切り替わり、ユーザーモードでシステムコールの呼び出し元のプログラムが再開される。
